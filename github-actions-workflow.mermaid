stateDiagram-v2
    [*] --> SecurityChecks : Trigger Workflow
    SecurityChecks --> TerraformPlan : Passes Security Checks
    TerraformPlan --> TerraformApply : On main branch
    TerraformPlan --> [*] : On Pull Request
    TerraformApply --> ConfigureInfrastructure : Successful Apply
    ConfigureInfrastructure --> SlackNotification : Deployment Complete
    SlackNotification --> [*]

    state SecurityChecks {
        TerraformSecurityScan
        YAMLLint
    }

    state TerraformPlan {
        AWSCredentials
        TerraformFormat
        TerraformInit
        TerraformValidate
        InfrastructureCheck
        DestroyExistingInfra
        CreatePlan
    }

    state TerraformApply {
        DownloadArtifacts
        ApplyTerraformPlan
    }

    state ConfigureInfrastructure {
        SSHKeySetup
        SetupPython
        InstallDependencies
        RunAnsiblePlaybook
    }

    state SlackNotification {
        SendFailureAlert
    }

    note right of SecurityChecks
        Runs security scans
        on Terraform and YAML
    end note

    note right of TerraformPlan
        Validates and plans
        infrastructure changes
    end note

    note right of TerraformApply
        Applies infrastructure
        only on main branch
    end note

    note right of ConfigureInfrastructure
        Configures EC2 instances
        using Ansible
    end note
